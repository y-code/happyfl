<div class="container">

  <div class="row header sticky-top bg-light">
    <div class="col-12 align-self-center">
      <h1 class="text-center app-name">Recipe Seeker</h1>
    </div>
    <div class="col-12 text-right site-link">
      <a class="" href="{{url}}" target="_blank">Open in {{getSiteDomain()}}</a>
    </div>
  </div>

  <div
    *ngIf="(recipeSeekResult$ | async) && (recipeSeekResult$ | async).isLoading"
    class="row fill-window">
    <div class="col-12 align-self-center text-center">
      Loading...
    </div>
  </div>

  <div
    *ngIf="(recipeSeekResult$ | async) && (recipeSeekResult$ | async).isCancelled"
    class="row fill-window">
    <div class="col-12 align-self-center">
      <div class="text-center">
        Cancelled
      </div>
    </div>
  </div>

  <div
    *ngIf="(recipeSeekResult$ | async) && !(recipeSeekResult$ | async).isLoading && !(recipeSeekResult$ | async).isCancelled"
    class="row no-gutters">
    <div class="col-12">
      <div class="form-group">
        <label for="recipeName">Recipe Name</label>
        <app-candidates-combobox
          name="recipeName"
          placeholder="Please enter this recipe's name."
          [(ngModel)]="recipe.name"
          [options]="(recipeSeekResult$ | async).data.names">
        </app-candidates-combobox>
      </div>

      <h3>Ingredients</h3>
      <div
        *ngFor="let group of (ingredientCandidatesBySection$ | async ); let i = index">
        <h4>Section {{(i + 10).toString(36).toUpperCase()}}</h4>
        <div class="form-group">
          <label for="sectionName">Section Name</label>
          <app-candidates-combobox
            name="sectionName"
            placeholder="Please enter this section's name, if you need it."
            [ngModel]="sections[i]?.name"
            (ngModelChange)="sections[i].name = $event"
            [options]="extractSectionNameCandidatesFrom(group.section)">
          </app-candidates-combobox>
        </div>
        <div class="form-group">
          <label>Ingredients ({{group.ingredients.length}})</label>
          <div *ngIf="group.ingredients">
            <div
              class="row ingredient-row"
              *ngFor="let ingredient of group.ingredients; let j = index;">
              <app-ingredient-candidates-combobox
                class="col-12"
                name="ingredient-{{i}}-{{j}}"
                [ngModel]="ingredientsBySection[i]?.ingredients[j]"
                (ngModelChange)="ingredientsBySection[i].ingredients[j] = $event"
                [options]="ingredient.candidates"
                [original]="ingredient.input">
              </app-ingredient-candidates-combobox>
            </div>
          </div>
        </div>
      </div>
      <div class="text-center row-btn">
        <span
          class="btn btn-primary btn-save"
          (click)="save()">
          Save
        </span>
      </div>
    </div>
  </div>

</div>
